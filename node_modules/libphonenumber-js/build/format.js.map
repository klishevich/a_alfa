{"version":3,"sources":["../source/format.js"],"names":["format","format_national_number_using_format","choose_format_for_number","local_to_international_style","default_options","formatExtension","number","extension","arg_1","arg_2","arg_3","arg_4","arg_5","sort_out_arguments","input","format_type","options","metadata","country","hasCountry","phone","countryCallingCode","selectedCountry","chooseCountryByCountryCallingCode","format_national_number","add_extension","ext","FIRST_GROUP_PATTERN","international","enforce_national_prefix","format_pattern_matcher","RegExp","pattern","national_prefix_may_be_omitted","nationalPrefixFormattingRule","nationalPrefixIsOptionalWhenFormatting","replace","formatted_number","internationalFormat","format_as","formats","available_formats","national_number","leadingDigitsPatterns","length","last_leading_digits_pattern","search","local","trim","Error","is_object","TypeError","_"],"mappings":"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","file":"format.js","sourcesContent":["// This is a port of Google Android `libphonenumber`'s\r\n// `phonenumberutil.js` of 17th November, 2016.\r\n//\r\n// https://github.com/googlei18n/libphonenumber/commits/master/javascript/i18n/phonenumbers/phonenumberutil.js\r\n\r\nimport\r\n{\r\n\tparse_national_number_and_country_calling_code,\r\n\tVALID_PUNCTUATION,\r\n\tmatches_entirely\r\n}\r\nfrom './common'\r\n\r\nimport Metadata from './metadata'\r\n\r\nimport { formatRFC3966 } from './RFC3966'\r\n\r\nconst default_options =\r\n{\r\n\tformatExtension: (number, extension) => `${number} ext. ${extension}`\r\n}\r\n\r\n// Formats a phone number\r\n//\r\n// Example use cases:\r\n//\r\n// ```js\r\n// format('8005553535', 'RU', 'International')\r\n// format('8005553535', 'RU', 'International', metadata)\r\n// format({ phone: '8005553535', country: 'RU' }, 'International')\r\n// format({ phone: '8005553535', country: 'RU' }, 'International', metadata)\r\n// format('+78005553535', 'National')\r\n// format('+78005553535', 'National', metadata)\r\n// ```\r\n//\r\nexport default function format(arg_1, arg_2, arg_3, arg_4, arg_5)\r\n{\r\n\tconst\r\n\t{\r\n\t\tinput,\r\n\t\tformat_type,\r\n\t\toptions,\r\n\t\tmetadata\r\n\t}\r\n\t= sort_out_arguments(arg_1, arg_2, arg_3, arg_4, arg_5)\r\n\r\n\tif (input.country && metadata.hasCountry(input.country))\r\n\t{\r\n\t\tmetadata.country(input.country)\r\n\t}\r\n\r\n\tlet { countryCallingCode, number } = parse_national_number_and_country_calling_code(input.phone, metadata)\r\n\r\n\tcountryCallingCode = countryCallingCode || input.countryCallingCode\r\n\r\n\tif (countryCallingCode)\r\n\t{\r\n\t\t// Check country restriction\r\n\t\tif (input.country && metadata.selectedCountry() &&\r\n\t\t\tcountryCallingCode !== metadata.countryCallingCode())\r\n\t\t{\r\n\t\t\treturn input.phone\r\n\t\t}\r\n\r\n\t\tmetadata.chooseCountryByCountryCallingCode(countryCallingCode)\r\n\t}\r\n\r\n\tif (!metadata.selectedCountry())\r\n\t{\r\n\t\treturn input.phone\r\n\t}\r\n\r\n\tswitch (format_type)\r\n\t{\r\n\t\tcase 'International':\r\n\t\t\tif (!number) {\r\n\t\t\t\treturn `+${metadata.countryCallingCode()}`\r\n\t\t\t}\r\n\t\t\tnumber = format_national_number(number, 'International', false, metadata)\r\n\t\t\tnumber = `+${metadata.countryCallingCode()} ${number}`\r\n\t\t\treturn add_extension(number, input.ext, options.formatExtension)\r\n\r\n\t\tcase 'E.164':\r\n\t\t\t// `E.164` doesn't define \"phone number extensions\".\r\n\t\t\treturn `+${metadata.countryCallingCode()}${input.phone}`\r\n\r\n\t\tcase 'RFC3966':\r\n\t\t\treturn formatRFC3966\r\n\t\t\t({\r\n\t\t\t\tnumber : `+${metadata.countryCallingCode()}${input.phone}`,\r\n\t\t\t\text    : input.ext\r\n\t\t\t})\r\n\r\n\t\tcase 'National':\r\n\t\t\tif (!number) {\r\n\t\t\t\treturn ''\r\n\t\t\t}\r\n\t\t\tnumber = format_national_number(number, 'National', false, metadata)\r\n\t\t\treturn add_extension(number, input.ext, options.formatExtension)\r\n\t}\r\n}\r\n\r\n// This was originally set to $1 but there are some countries for which the\r\n// first group is not used in the national pattern (e.g. Argentina) so the $1\r\n// group does not match correctly.  Therefore, we use \\d, so that the first\r\n// group actually used in the pattern will be matched.\r\nexport const FIRST_GROUP_PATTERN = /(\\$\\d)/\r\n\r\nexport function format_national_number_using_format(number, format, international, enforce_national_prefix, metadata)\r\n{\r\n\tconst format_pattern_matcher = new RegExp(format.pattern())\r\n\r\n\t// National prefix is omitted if there's no national prefix formatting rule\r\n\t// set for this country, or when this rule is set but\r\n\t// national prefix is optional for this phone number format\r\n\t// (and it is not enforced explicitly)\r\n\tconst national_prefix_may_be_omitted = !format.nationalPrefixFormattingRule() ||\r\n\t\t(format.nationalPrefixFormattingRule() && format.nationalPrefixIsOptionalWhenFormatting() && !enforce_national_prefix)\r\n\r\n\tif (!international && !national_prefix_may_be_omitted)\r\n\t{\r\n\t\treturn number.replace\r\n\t\t(\r\n\t\t\tformat_pattern_matcher,\r\n\t\t\tformat.format().replace\r\n\t\t\t(\r\n\t\t\t\tFIRST_GROUP_PATTERN,\r\n\t\t\t\tformat.nationalPrefixFormattingRule()\r\n\t\t\t)\r\n\t\t)\r\n\t}\r\n\r\n\tconst formatted_number = number.replace\r\n\t(\r\n\t\tformat_pattern_matcher,\r\n\t\tinternational ? format.internationalFormat() : format.format()\r\n\t)\r\n\r\n\tif (international)\r\n\t{\r\n\t\treturn local_to_international_style(formatted_number)\r\n\t}\r\n\r\n\treturn formatted_number\r\n}\r\n\r\nfunction format_national_number(number, format_as, enforce_national_prefix, metadata)\r\n{\r\n\tconst format = choose_format_for_number(metadata.formats(), number)\r\n\r\n\tif (!format)\r\n\t{\r\n\t\treturn number\r\n\t}\r\n\r\n\treturn format_national_number_using_format(number, format, format_as === 'International', enforce_national_prefix, metadata)\r\n}\r\n\r\nexport function choose_format_for_number(available_formats, national_number)\r\n{\r\n\tfor (const format of available_formats)\r\n\t{\r\n\t\t// Validate leading digits\r\n\t\tif (format.leadingDigitsPatterns().length > 0)\r\n\t\t{\r\n\t\t\t// The last leading_digits_pattern is used here, as it is the most detailed\r\n\t\t\tconst last_leading_digits_pattern = format.leadingDigitsPatterns()[format.leadingDigitsPatterns().length - 1]\r\n\r\n\t\t\t// If leading digits don't match then move on to the next phone number format\r\n\t\t\tif (national_number.search(last_leading_digits_pattern) !== 0)\r\n\t\t\t{\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Check that the national number matches the phone number format regular expression\r\n\t\tif (matches_entirely(national_number, new RegExp(format.pattern())))\r\n\t\t{\r\n\t\t\treturn format\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Removes brackets and replaces dashes with spaces.\r\n//\r\n// E.g. \"(999) 111-22-33\" -> \"999 111 22 33\"\r\n//\r\nexport function local_to_international_style(local)\r\n{\r\n\treturn local.replace(new RegExp(`[${VALID_PUNCTUATION}]+`, 'g'), ' ').trim()\r\n}\r\n\r\n// Sort out arguments\r\nfunction sort_out_arguments(arg_1, arg_2, arg_3, arg_4, arg_5)\r\n{\r\n\tlet input\r\n\tlet format_type\r\n\tlet options\r\n\tlet metadata\r\n\r\n\t// Sort out arguments.\r\n\r\n\t// If the phone number is passed as a string.\r\n\t// `format('8005553535', ...)`.\r\n\tif (typeof arg_1 === 'string')\r\n\t{\r\n\t\t// If country code is supplied.\r\n\t\t// `format('8005553535', 'RU', 'National', [options], metadata)`.\r\n\t\tif (typeof arg_3 === 'string')\r\n\t\t{\r\n\t\t\t// Will be `parse()`d later in code\r\n\t\t\tinput =\r\n\t\t\t{\r\n\t\t\t\tphone   : arg_1,\r\n\t\t\t\tcountry : arg_2\r\n\t\t\t}\r\n\r\n\t\t\tformat_type = arg_3\r\n\r\n\t\t\tif (arg_5)\r\n\t\t\t{\r\n\t\t\t\toptions  = arg_4\r\n\t\t\t\tmetadata = arg_5\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tmetadata = arg_4\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Just an international phone number is supplied\r\n\t\t// `format('+78005553535', 'National', [options], metadata)`.\r\n\t\telse\r\n\t\t{\r\n\t\t\t// Will be `parse()`d later in code\r\n\t\t\tinput =\r\n\t\t\t{\r\n\t\t\t\tphone : arg_1\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof arg_2 !== 'string')\r\n\t\t\t{\r\n\t\t\t\tthrow new Error('Format type argument not passed for `format()`')\r\n\t\t\t}\r\n\r\n\t\t\tformat_type = arg_2\r\n\r\n\t\t\tif (arg_4)\r\n\t\t\t{\r\n\t\t\t\toptions  = arg_3\r\n\t\t\t\tmetadata = arg_4\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tmetadata = arg_3\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t// If the phone number is passed as a parsed number object.\r\n\t// `format({ phone: '8005553535', country: 'RU' }, 'National', [options], metadata)`.\r\n\telse if (is_object(arg_1) && typeof arg_1.phone === 'string')\r\n\t{\r\n\t\tinput       = arg_1\r\n\t\tformat_type = arg_2\r\n\r\n\t\tif (arg_4)\r\n\t\t{\r\n\t\t\toptions  = arg_3\r\n\t\t\tmetadata = arg_4\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tmetadata = arg_3\r\n\t\t}\r\n\t}\r\n\telse throw new TypeError('A phone number must either be a string or an object of shape { phone, [country] }.')\r\n\r\n\t// Metadata is required.\r\n\tif (!metadata)\r\n\t{\r\n\t\tthrow new Error('Metadata is required')\r\n\t}\r\n\r\n\t// Validate `format_type`.\r\n\tswitch (format_type)\r\n\t{\r\n\t\tcase 'International':\r\n\t\tcase 'E.164':\r\n\t\tcase 'National':\r\n\t\tcase 'RFC3966':\r\n\t\t\tbreak\r\n\t\tdefault:\r\n\t\t\tthrow new Error(`Unknown format type argument passed to \"format()\": \"${format_type}\"`)\r\n\t}\r\n\r\n\t// Apply default options.\r\n\tif (options)\r\n\t{\r\n\t\toptions = { ...default_options, ...options }\r\n\t}\r\n\telse\r\n\t{\r\n\t\toptions = default_options\r\n\t}\r\n\r\n\treturn { input, format_type, options, metadata: new Metadata(metadata) }\r\n}\r\n\r\n// Babel transforms `typeof` into some \"branches\"\r\n// so istanbul will show this as \"branch not covered\".\r\n/* istanbul ignore next */\r\nconst is_object = _ => typeof _ === 'object'\r\n\r\nfunction add_extension(number, ext, formatExtension)\r\n{\r\n\treturn ext ? formatExtension(number, ext) : number\r\n}"]}